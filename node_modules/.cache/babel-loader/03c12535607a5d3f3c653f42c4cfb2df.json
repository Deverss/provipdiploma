{"ast":null,"code":"import _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _get from '@babel/runtime/helpers/get';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { createEventEmitterProxy, BaseController, providerFromEngine } from '@toruslabs/base-controllers';\nimport { WalletInitializationError } from '@web3auth/base';\nimport { ethErrors } from 'eth-rpc-errors';\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { JRPCEngine, createScaffoldMiddleware, createAsyncMiddleware } from '@toruslabs/openlogin-jrpc';\nimport getCreateRandomId from 'json-rpc-random-id';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar BaseProvider = /*#__PURE__*/function (_BaseController) {\n  _inherits(BaseProvider, _BaseController);\n\n  var _super = _createSuper(BaseProvider); // should be Assigned in setupProvider\n\n\n  function BaseProvider(_ref) {\n    var _thisSuper, _this;\n\n    var config = _ref.config,\n        state = _ref.state;\n\n    _classCallCheck(this, BaseProvider);\n\n    _this = _super.call(this, {\n      config: config,\n      state: state\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_providerEngineProxy\", null);\n\n    if (!config.chainConfig) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainConfig\");\n    if (!config.chainConfig.chainId) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainId inside chainConfig\");\n    if (!config.chainConfig.rpcTarget) throw WalletInitializationError.invalidProviderConfigError(\"Please provide rpcTarget inside chainConfig\");\n    _this.defaultState = {\n      chainId: \"loading\"\n    };\n    _this.defaultConfig = {\n      chainConfig: config.chainConfig,\n      networks: _defineProperty({}, config.chainConfig.chainId, config.chainConfig)\n    };\n\n    _get((_thisSuper = _assertThisInitialized(_this), _getPrototypeOf(BaseProvider.prototype)), \"initialize\", _thisSuper).call(_thisSuper);\n\n    return _this;\n  }\n\n  _createClass(BaseProvider, [{\n    key: \"provider\",\n    get: function get() {\n      return this._providerEngineProxy;\n    },\n    set: function set(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"addChain\",\n    value: function addChain(chainConfig) {\n      if (!chainConfig.chainId) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n      if (!chainConfig.rpcTarget) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n      this.configure({\n        networks: _objectSpread(_objectSpread({}, this.config.networks), {}, _defineProperty({}, chainConfig.chainId, chainConfig))\n      });\n    }\n  }, {\n    key: \"getChainConfig\",\n    value: function getChainConfig(chainId) {\n      var _this$config$networks;\n\n      var chainConfig = (_this$config$networks = this.config.networks) === null || _this$config$networks === void 0 ? void 0 : _this$config$networks[chainId];\n      if (!chainConfig) throw ethErrors.rpc.invalidRequest(\"Chain \".concat(chainId, \" is not supported, please add chainConfig for it\"));\n      return chainConfig;\n    }\n  }, {\n    key: \"getProviderEngineProxy\",\n    value: function getProviderEngineProxy() {\n      return this._providerEngineProxy;\n    }\n  }, {\n    key: \"updateProviderEngineProxy\",\n    value: function updateProviderEngineProxy(providerEngineProxy) {\n      if (this._providerEngineProxy) {\n        this._providerEngineProxy.setTarget(providerEngineProxy);\n      } else {\n        this._providerEngineProxy = createEventEmitterProxy(providerEngineProxy);\n      }\n    }\n  }]);\n\n  return BaseProvider;\n}(BaseController);\n\nvar CommonPrivateKeyProvider = /*#__PURE__*/function () {\n  function CommonPrivateKeyProvider() {\n    _classCallCheck(this, CommonPrivateKeyProvider);\n\n    _defineProperty(this, \"_providerEngineProxy\", null);\n  }\n\n  _createClass(CommonPrivateKeyProvider, [{\n    key: \"provider\",\n    get: function get() {\n      return this._providerEngineProxy;\n    },\n    set: function set(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"addChain\",\n    value: function addChain(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"setupProvider\",\n    value: function () {\n      var _setupProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(privKey) {\n        var privKeyMiddleware, engine, provider;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                privKeyMiddleware = this.getPrivKeyMiddleware(privKey);\n                engine = new JRPCEngine();\n                engine.push(privKeyMiddleware);\n                provider = providerFromEngine(engine);\n                this.updateProviderEngineProxy(provider);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setupProvider(_x) {\n        return _setupProvider.apply(this, arguments);\n      }\n\n      return setupProvider;\n    }()\n  }, {\n    key: \"switchChain\",\n    value: function () {\n      var _switchChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", Promise.resolve());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function switchChain(_x2) {\n        return _switchChain.apply(this, arguments);\n      }\n\n      return switchChain;\n    }()\n  }, {\n    key: \"getProviderEngineProxy\",\n    value: function getProviderEngineProxy() {\n      return this._providerEngineProxy;\n    }\n  }, {\n    key: \"updateProviderEngineProxy\",\n    value: function updateProviderEngineProxy(providerEngineProxy) {\n      if (this._providerEngineProxy) {\n        this._providerEngineProxy.setTarget(providerEngineProxy);\n      } else {\n        this._providerEngineProxy = createEventEmitterProxy(providerEngineProxy);\n      }\n    }\n  }, {\n    key: \"getPrivKeyMiddleware\",\n    value: function getPrivKeyMiddleware(privKey) {\n      var middleware = {\n        getPrivatekey: function () {\n          var _getPrivatekey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n            return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    return _context3.abrupt(\"return\", privKey);\n\n                  case 1:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee3);\n          }));\n\n          function getPrivatekey() {\n            return _getPrivatekey.apply(this, arguments);\n          }\n\n          return getPrivatekey;\n        }()\n      };\n      return this.createPrivKeyMiddleware(middleware);\n    }\n  }, {\n    key: \"createPrivKeyMiddleware\",\n    value: function createPrivKeyMiddleware(_ref) {\n      var getPrivatekey = _ref.getPrivatekey;\n\n      function getPrivatekeyHandler(_x3, _x4) {\n        return _getPrivatekeyHandler.apply(this, arguments);\n      }\n\n      function _getPrivatekeyHandler() {\n        _getPrivatekeyHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_, res) {\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return getPrivatekey();\n\n                case 2:\n                  res.result = _context4.sent;\n\n                case 3:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n        return _getPrivatekeyHandler.apply(this, arguments);\n      }\n\n      return createScaffoldMiddleware({\n        private_key: createAsyncMiddleware(getPrivatekeyHandler)\n      });\n    }\n  }]);\n\n  return CommonPrivateKeyProvider;\n}();\n\n_defineProperty(CommonPrivateKeyProvider, \"getProviderInstance\", /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(params) {\n    var providerFactory;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            providerFactory = new CommonPrivateKeyProvider();\n            _context5.next = 3;\n            return providerFactory.setupProvider(params.privKey);\n\n          case 3:\n            return _context5.abrupt(\"return\", providerFactory);\n\n          case 4:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function (_x5) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nvar createRandomId = getCreateRandomId();\nexport { BaseProvider, CommonPrivateKeyProvider, createRandomId };","map":{"version":3,"sources":["../src/baseProvider.ts","../src/commonPrivateKeyProvider.ts","../src/utils.ts"],"names":["BaseProvider","config","state","WalletInitializationError","chainId","chainConfig","networks","ethErrors","createEventEmitterProxy","CommonPrivateKeyProvider","providerFactory","params","privKeyMiddleware","engine","provider","providerFromEngine","Promise","middleware","getPrivatekey","res","createScaffoldMiddleware","private_key","createAsyncMiddleware","createRandomId","getCreateRandomId"],"mappings":"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","sourcesContent":["import _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _possibleConstructorReturn from '@babel/runtime/helpers/possibleConstructorReturn';\nimport _get from '@babel/runtime/helpers/get';\nimport _getPrototypeOf from '@babel/runtime/helpers/getPrototypeOf';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { createEventEmitterProxy, BaseController, providerFromEngine } from '@toruslabs/base-controllers';\nimport { WalletInitializationError } from '@web3auth/base';\nimport { ethErrors } from 'eth-rpc-errors';\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport { JRPCEngine, createScaffoldMiddleware, createAsyncMiddleware } from '@toruslabs/openlogin-jrpc';\nimport getCreateRandomId from 'json-rpc-random-id';\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nvar BaseProvider = /*#__PURE__*/function (_BaseController) {\n  _inherits(BaseProvider, _BaseController);\n\n  var _super = _createSuper(BaseProvider);\n\n  // should be Assigned in setupProvider\n  function BaseProvider(_ref) {\n    var _thisSuper, _this;\n\n    var config = _ref.config,\n        state = _ref.state;\n\n    _classCallCheck(this, BaseProvider);\n\n    _this = _super.call(this, {\n      config: config,\n      state: state\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_providerEngineProxy\", null);\n\n    if (!config.chainConfig) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainConfig\");\n    if (!config.chainConfig.chainId) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainId inside chainConfig\");\n    if (!config.chainConfig.rpcTarget) throw WalletInitializationError.invalidProviderConfigError(\"Please provide rpcTarget inside chainConfig\");\n    _this.defaultState = {\n      chainId: \"loading\"\n    };\n    _this.defaultConfig = {\n      chainConfig: config.chainConfig,\n      networks: _defineProperty({}, config.chainConfig.chainId, config.chainConfig)\n    };\n\n    _get((_thisSuper = _assertThisInitialized(_this), _getPrototypeOf(BaseProvider.prototype)), \"initialize\", _thisSuper).call(_thisSuper);\n\n    return _this;\n  }\n\n  _createClass(BaseProvider, [{\n    key: \"provider\",\n    get: function get() {\n      return this._providerEngineProxy;\n    },\n    set: function set(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"addChain\",\n    value: function addChain(chainConfig) {\n      if (!chainConfig.chainId) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n      if (!chainConfig.rpcTarget) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n      this.configure({\n        networks: _objectSpread(_objectSpread({}, this.config.networks), {}, _defineProperty({}, chainConfig.chainId, chainConfig))\n      });\n    }\n  }, {\n    key: \"getChainConfig\",\n    value: function getChainConfig(chainId) {\n      var _this$config$networks;\n\n      var chainConfig = (_this$config$networks = this.config.networks) === null || _this$config$networks === void 0 ? void 0 : _this$config$networks[chainId];\n      if (!chainConfig) throw ethErrors.rpc.invalidRequest(\"Chain \".concat(chainId, \" is not supported, please add chainConfig for it\"));\n      return chainConfig;\n    }\n  }, {\n    key: \"getProviderEngineProxy\",\n    value: function getProviderEngineProxy() {\n      return this._providerEngineProxy;\n    }\n  }, {\n    key: \"updateProviderEngineProxy\",\n    value: function updateProviderEngineProxy(providerEngineProxy) {\n      if (this._providerEngineProxy) {\n        this._providerEngineProxy.setTarget(providerEngineProxy);\n      } else {\n        this._providerEngineProxy = createEventEmitterProxy(providerEngineProxy);\n      }\n    }\n  }]);\n\n  return BaseProvider;\n}(BaseController);\n\nvar CommonPrivateKeyProvider = /*#__PURE__*/function () {\n  function CommonPrivateKeyProvider() {\n    _classCallCheck(this, CommonPrivateKeyProvider);\n\n    _defineProperty(this, \"_providerEngineProxy\", null);\n  }\n\n  _createClass(CommonPrivateKeyProvider, [{\n    key: \"provider\",\n    get: function get() {\n      return this._providerEngineProxy;\n    },\n    set: function set(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"addChain\",\n    value: function addChain(_) {\n      throw new Error(\"Method not implemented.\");\n    }\n  }, {\n    key: \"setupProvider\",\n    value: function () {\n      var _setupProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(privKey) {\n        var privKeyMiddleware, engine, provider;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                privKeyMiddleware = this.getPrivKeyMiddleware(privKey);\n                engine = new JRPCEngine();\n                engine.push(privKeyMiddleware);\n                provider = providerFromEngine(engine);\n                this.updateProviderEngineProxy(provider);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function setupProvider(_x) {\n        return _setupProvider.apply(this, arguments);\n      }\n\n      return setupProvider;\n    }()\n  }, {\n    key: \"switchChain\",\n    value: function () {\n      var _switchChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", Promise.resolve());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function switchChain(_x2) {\n        return _switchChain.apply(this, arguments);\n      }\n\n      return switchChain;\n    }()\n  }, {\n    key: \"getProviderEngineProxy\",\n    value: function getProviderEngineProxy() {\n      return this._providerEngineProxy;\n    }\n  }, {\n    key: \"updateProviderEngineProxy\",\n    value: function updateProviderEngineProxy(providerEngineProxy) {\n      if (this._providerEngineProxy) {\n        this._providerEngineProxy.setTarget(providerEngineProxy);\n      } else {\n        this._providerEngineProxy = createEventEmitterProxy(providerEngineProxy);\n      }\n    }\n  }, {\n    key: \"getPrivKeyMiddleware\",\n    value: function getPrivKeyMiddleware(privKey) {\n      var middleware = {\n        getPrivatekey: function () {\n          var _getPrivatekey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n            return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    return _context3.abrupt(\"return\", privKey);\n\n                  case 1:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee3);\n          }));\n\n          function getPrivatekey() {\n            return _getPrivatekey.apply(this, arguments);\n          }\n\n          return getPrivatekey;\n        }()\n      };\n      return this.createPrivKeyMiddleware(middleware);\n    }\n  }, {\n    key: \"createPrivKeyMiddleware\",\n    value: function createPrivKeyMiddleware(_ref) {\n      var getPrivatekey = _ref.getPrivatekey;\n\n      function getPrivatekeyHandler(_x3, _x4) {\n        return _getPrivatekeyHandler.apply(this, arguments);\n      }\n\n      function _getPrivatekeyHandler() {\n        _getPrivatekeyHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_, res) {\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return getPrivatekey();\n\n                case 2:\n                  res.result = _context4.sent;\n\n                case 3:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n        return _getPrivatekeyHandler.apply(this, arguments);\n      }\n\n      return createScaffoldMiddleware({\n        private_key: createAsyncMiddleware(getPrivatekeyHandler)\n      });\n    }\n  }]);\n\n  return CommonPrivateKeyProvider;\n}();\n\n_defineProperty(CommonPrivateKeyProvider, \"getProviderInstance\", /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(params) {\n    var providerFactory;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            providerFactory = new CommonPrivateKeyProvider();\n            _context5.next = 3;\n            return providerFactory.setupProvider(params.privKey);\n\n          case 3:\n            return _context5.abrupt(\"return\", providerFactory);\n\n          case 4:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function (_x5) {\n    return _ref2.apply(this, arguments);\n  };\n}());\n\nvar createRandomId = getCreateRandomId();\n\nexport { BaseProvider, CommonPrivateKeyProvider, createRandomId };\n//# sourceMappingURL=baseProvider.esm.js.map\n"]},"metadata":{},"sourceType":"module"}